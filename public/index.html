<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Préparation de trajet</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    </head>
    <body>
    <header>
        <h1>Préparation de trajet</h1>
        <p>Ce site web permet la préparation d'itinéraire en fonction du véhicule éléctrique choisie !<br>
            En fonction de l'état de la batterie et du temps de rechargement, vous pourrez ainsi <br>
            préparer vos trajets sereinements
        </p>

    </header>

            <h2>Choix du Véhicule</h2>
            
            <div class="control has-icons-left">
                <div class="select">
                    <select id= "select">
                    </select>
                </div>
                <span class="material-icons-outlined">directions_car_filled</span>
            </div>

            <button id="Refresh" type="button">Refresh</button>
            <p id="batterieActuelle"></p>
            <p id="tempsChargement"></p>
        </div>
        <div>
            <h2>Calcul du trajet</h>
                <label>Autonomie (en min): </label>
                    <input type="text" id="autonomie" name="autonomie">
                
                <br>
                <label>Temps de charge (en min):</label>
                    <input type="text" id="tempsCharge" name="tempsCharge">
                
                <br>
                <label>Distance à parcourir (en min)</label>
                    <input type="text" id="distance" name="distance">
                
                <br>
                <label>Vitesse moyenne: (en km/h)</label>
                    <input type="text" id="vitesse" name="vitesse">
                <br>
                <button class="button is-primary" id="calc">Calculer</button>
            <p id="resultat"></p>
        </div>
        


        



        <script src="/socket.io/socket.io.js"></script>
        <script>
            ///////Déclaration///////
            var socket = io();
            var dico;
            var text = document.getElementById('list');
            var select = document.getElementById('select');
            var refresh = document.getElementById('Refresh');
            var batterie = document.getElementById('batterieActuelle');
            var charge = document.getElementById('tempsChargement');
            var buttonCalc = document.getElementById("calc");
            


            /////Listener//////
            select.onchange = function() {
                var tab = dico[select.value];
                var heure = Math.floor(tab[1]/60);
                var minutes = tab[1]%60;
                if(heure==0){
                    charge.innerText = "Temps de chargement: "+ minutes +" minutes";
                }else{
                    charge.innerText = "Temps de chargement: "+heure + " heure(s) " + ((minutes>0)?"et " + minutes +" minutes":"");
                }
                
                batterie.innerText = "Autonomie: "+tab[0] +" km";
            }

            buttonCalc.addEventListener('click',function(){
                emitCalc();
            });

            ////SOCKET////
            socket.emit('getList');
            refresh.onclick = function(){
                socket.emit('getList');
            };

            socket.on('res',function(res){
                dico = res.carListResult;
                removeOptions();
                console.log(dico);
                for (var obj in dico){
                    var opt = document.createElement("option");
                    opt.value = obj;
                    opt.text = obj;
                    select.add(opt);
                }
                });
            socket.on('resCalc',function(res){
                console.log(res);
                var textCalc = document.getElementById("resultat");
                textCalc.innerText ="";
                for(var obj in res){
                    textCalc.innerText += obj+": "+res[obj]+" "; 
                }
            });
            ////////Méthodes////////
            function removeOptions() {
                var i, L = select.options.length - 1;
                for(i = L; i >= 0; i--) {
                    select.remove(i);
                }
            }

            function emitCalc(){
                var distanceInput = document.getElementById("distance").value;
                var vitesseInput = document.getElementById("vitesse").value;
                var chargeInput = document.getElementById("tempsCharge").value;
                var autonomieInput = document.getElementById("autonomie").value;
                var doc = {"autonomie":autonomieInput,"vitesse":vitesseInput,"distance":distanceInput,"chargement":chargeInput};
                console.log(doc);
                socket.emit('calcReq',doc);
            }
        </script>    

    </body>
</html>